<script>
    import ButtonWithIcon from "$components/Controlls/ButtonWithIcon.svelte";
    import { checkboxes } from "$components/Controlls/stores/checkboxesStore";
    import { DANGER } from "$data/consts";
    import {
        YOU_HAVE,
        ITEMS_SELECTED,
        SELECT_ALL_ITEMS,
        DESELECT_ALL,
        DELETE_SELECTED,
    } from "$data/texts.js";
    import { deleteSelectedItems } from "$items/deleteSelectedItems.js";
    import { onDestroy } from "svelte";

    export let collection_id = 0;

    let items_quantity = 0;

    checkboxes.subscribe((data) => {
        items_quantity = 0;
        for (let item of Object.values(data)) {
            if (item.selected) {
                items_quantity++;
            }
        }
    });

    onDestroy(() => {
        checkboxes.set({});
    });

    let active = false;
    let deleteButtonBlockState = false;

    async function deleteSelected(e) {
        if (deleteButtonBlockState) return;
        deleteButtonBlockState = true;
        await deleteSelectedItems(e, collection_id);
        deleteButtonBlockState = false;
    }

    function selectAll() {
        if (active) {
            checkboxes.update((data) => {
                for (let checkObj of Object.values(data)) {
                    checkObj.selected = false;
                }
                return data;
            });
            active = false;
        } else {
            checkboxes.update((data) => {
                for (let checkObj of Object.values(data)) {
                    checkObj.selected = true;
                }
                return data;
            });
            active = true;
        }
    }
</script>

<div class="items_header">
    <div class="button_wrapper">
        <ButtonWithIcon clickHandler={selectAll}>
            <svg
                width="21"
                height="21"
                viewBox="0 0 21 21"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
                slot="icon"
            >
                <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M1.50208 0C0.679592 0 0.00210045 0.677491 0.00210045 1.49998L0.000100497 14.5018C0.000100497 15.1693 1.00109 15.1693 1.00109 14.5018L1.00209 1.49998C1.00209 1.21448 1.21659 0.999987 1.50208 0.999987H15.5019C15.7874 0.999987 16.0019 1.21448 16.0019 1.49998V10.4999C15.9919 11.1759 17.0119 11.1759 17.0019 10.4999V1.49998C17.0019 0.677491 16.3244 0 15.5019 0H1.50208ZM4.50204 3.99995C4.36944 3.99995 4.24226 4.05263 4.14849 4.14639C4.05473 4.24016 4.00205 4.36734 4.00205 4.49994C4.00205 4.63255 4.05473 4.75972 4.14849 4.85349C4.24226 4.94726 4.36944 4.99994 4.50204 4.99994C4.63465 4.99994 4.76183 4.94726 4.85559 4.85349C4.94936 4.75972 5.00204 4.63255 5.00204 4.49994C5.00204 4.36734 4.94936 4.24016 4.85559 4.14639C4.76183 4.05263 4.63465 3.99995 4.50204 3.99995ZM6.45202 4.00095C5.80053 4.04595 5.84703 5.01794 6.50002 5.00094H12.5019C13.1544 4.98694 13.1544 4.01495 12.5019 4.00095H6.50002C6.48403 4.00019 6.46801 4.00019 6.45202 4.00095ZM4.50204 6.99991C4.36944 6.99991 4.24226 7.05259 4.14849 7.14636C4.05473 7.24012 4.00205 7.3673 4.00205 7.49991C4.00205 7.63251 4.05473 7.75969 4.14849 7.85345C4.24226 7.94722 4.36944 7.9999 4.50204 7.9999C4.63465 7.9999 4.76183 7.94722 4.85559 7.85345C4.94936 7.75969 5.00204 7.63251 5.00204 7.49991C5.00204 7.3673 4.94936 7.24012 4.85559 7.14636C4.76183 7.05259 4.63465 6.99991 4.50204 6.99991ZM12.5569 6.99991C12.5384 6.99991 12.5199 6.99991 12.5019 7.00191H6.50002C6.48403 7.00116 6.46801 7.00116 6.45202 7.00191C5.83903 7.07791 5.88203 7.9809 6.50002 7.9979H12.5019C13.1884 8.0584 13.2459 7.01441 12.5569 6.99991ZM6.50002 9.99887C5.84753 10.0129 5.84753 10.9849 6.50002 10.9989H12.5019C13.1829 11.0139 13.1829 9.98387 12.5019 9.99887H6.50002ZM4.50204 9.99987C4.36944 9.99987 4.24226 10.0526 4.14849 10.1463C4.05473 10.2401 4.00205 10.3673 4.00205 10.4999C4.00205 10.6325 4.05473 10.7596 4.14849 10.8534C4.24226 10.9472 4.36944 10.9999 4.50204 10.9999C4.63465 10.9999 4.76183 10.9472 4.85559 10.8534C4.94936 10.7596 5.00204 10.6325 5.00204 10.4999C5.00204 10.3673 4.94936 10.2401 4.85559 10.1463C4.76183 10.0526 4.63465 9.99987 4.50204 9.99987ZM4.50204 12.9998C4.36944 12.9998 4.24226 13.0525 4.14849 13.1463C4.05473 13.24 4.00205 13.3672 4.00205 13.4998C4.00205 13.6324 4.05473 13.7596 4.14849 13.8534C4.24226 13.9471 4.36944 13.9998 4.50204 13.9998C4.63465 13.9998 4.76183 13.9471 4.85559 13.8534C4.94936 13.7596 5.00204 13.6324 5.00204 13.4998C5.00204 13.3672 4.94936 13.24 4.85559 13.1463C4.76183 13.0525 4.63465 12.9998 4.50204 12.9998ZM6.50002 12.9998C5.81903 12.9848 5.81903 14.0148 6.50002 13.9998H11.501C12.1819 14.0148 12.1819 12.9848 11.501 12.9998H6.50002ZM4.50204 15.9998C4.36944 15.9998 4.24226 16.0525 4.14849 16.1462C4.05473 16.24 4.00205 16.3672 4.00205 16.4998C4.00205 16.6324 4.05473 16.7596 4.14849 16.8533C4.24226 16.9471 4.36944 16.9998 4.50204 16.9998C4.63465 16.9998 4.76183 16.9471 4.85559 16.8533C4.94936 16.7596 5.00204 16.6324 5.00204 16.4998C5.00204 16.3672 4.94936 16.24 4.85559 16.1462C4.76183 16.0525 4.63465 15.9998 4.50204 15.9998ZM6.45202 15.9998C5.78503 16.0318 5.83253 17.0328 6.50002 17.0008H10.501C11.1685 17.0008 11.1685 15.9998 10.501 15.9998H6.50002C6.48403 15.999 6.46801 15.999 6.45202 15.9998ZM0.495094 16.4908C0.429006 16.4914 0.363702 16.5052 0.302959 16.5312C0.242216 16.5573 0.187239 16.5951 0.141208 16.6425C0.0951768 16.69 0.0590051 16.746 0.0347846 16.8075C0.0105641 16.869 -0.0012245 16.9347 0.000100497 17.0008L0.00210045 19.4998C0.00210045 20.3222 0.679592 20.9997 1.50208 20.9997H11.502C12.1779 21.0097 12.1779 19.9897 11.502 19.9997H1.50208C1.21659 19.9997 1.00209 19.7853 1.00209 19.4998L1.00109 17.0008C1.00243 16.9338 0.990294 16.8672 0.965393 16.805C0.940491 16.7427 0.903335 16.6862 0.856133 16.6386C0.808931 16.591 0.752646 16.5534 0.690624 16.528C0.628601 16.5026 0.562108 16.49 0.495094 16.4908ZM16.5029 11.9988C14.0234 11.9988 12.0039 14.0193 12.0039 16.4988C12.0039 18.9783 14.0239 21.0017 16.5029 21.0017C18.9824 21.0017 21.0018 18.9783 21.0018 16.4988C21.0018 14.0193 18.9819 11.9988 16.5029 11.9988ZM16.5029 12.9998C16.9627 12.9988 17.4181 13.0886 17.8431 13.264C18.2681 13.4395 18.6543 13.6972 18.9794 14.0223C19.3045 14.3474 19.5622 14.7336 19.7377 15.1586C19.9131 15.5835 20.0029 16.039 20.0018 16.4988C20.003 16.9587 19.9132 17.4144 19.7378 17.8396C19.5624 18.2647 19.3048 18.6511 18.9797 18.9765C18.6546 19.3019 18.2685 19.5598 17.8434 19.7356C17.4184 19.9114 16.9628 20.0015 16.5029 20.0007C16.0429 20.0015 15.5874 19.9114 15.1623 19.7356C14.7373 19.5598 14.3512 19.3019 14.0261 18.9765C13.701 18.6511 13.4433 18.2647 13.2679 17.8396C13.0925 17.4144 13.0028 16.9587 13.0039 16.4988C13.0029 16.039 13.0927 15.5835 13.2681 15.1586C13.4436 14.7336 13.7013 14.3474 14.0264 14.0223C14.3515 13.6972 14.7377 13.4395 15.1627 13.264C15.5876 13.0886 16.0431 12.9988 16.5029 12.9998ZM18.0819 14.9373C17.9524 14.9415 17.8296 14.9958 17.7394 15.0888L15.9714 16.8563L15.2664 16.1483C15.2201 16.1012 15.1648 16.0637 15.1039 16.038C15.043 16.0123 14.9776 15.9989 14.9115 15.9986C14.8454 15.9983 14.7798 16.0111 14.7187 16.0362C14.6575 16.0614 14.602 16.0984 14.5552 16.1451C14.5084 16.1918 14.4713 16.2473 14.4461 16.3084C14.4209 16.3695 14.408 16.435 14.4082 16.5011C14.4084 16.5673 14.4217 16.6327 14.4473 16.6936C14.4729 16.7546 14.5103 16.8099 14.5574 16.8563L15.6174 17.9158C15.6638 17.9623 15.719 17.9991 15.7797 18.0243C15.8404 18.0495 15.9054 18.0624 15.9711 18.0624C16.0369 18.0624 16.1019 18.0495 16.1626 18.0243C16.2233 17.9991 16.2785 17.9623 16.3249 17.9158L18.4484 15.7968C18.5213 15.7265 18.5711 15.6356 18.5913 15.5364C18.6114 15.4371 18.6009 15.334 18.5612 15.2408C18.5214 15.1476 18.4543 15.0687 18.3687 15.0145C18.2831 14.9603 18.1831 14.9334 18.0819 14.9373Z"
                    fill="currentColor"
                />
            </svg>
            <span slot="text">{active ? DESELECT_ALL : SELECT_ALL_ITEMS}</span>
        </ButtonWithIcon>
    </div>

    <div class="button_wrapper">
        <ButtonWithIcon clickHandler={deleteSelected} style={DANGER}>
            <svg
                slot="icon"
                width="18"
                height="20"
                viewBox="0 0 18 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                    d="M7 16C7.26522 16 7.51957 15.8946 7.70711 15.7071C7.89464 15.5196 8 15.2652 8 15V9C8 8.73478 7.89464 8.48043 7.70711 8.29289C7.51957 8.10536 7.26522 8 7 8C6.73478 8 6.48043 8.10536 6.29289 8.29289C6.10536 8.48043 6 8.73478 6 9V15C6 15.2652 6.10536 15.5196 6.29289 15.7071C6.48043 15.8946 6.73478 16 7 16ZM17 4H13V3C13 2.20435 12.6839 1.44129 12.1213 0.87868C11.5587 0.316071 10.7956 0 10 0H8C7.20435 0 6.44129 0.316071 5.87868 0.87868C5.31607 1.44129 5 2.20435 5 3V4H1C0.734784 4 0.48043 4.10536 0.292893 4.29289C0.105357 4.48043 0 4.73478 0 5C0 5.26522 0.105357 5.51957 0.292893 5.70711C0.48043 5.89464 0.734784 6 1 6H2V17C2 17.7956 2.31607 18.5587 2.87868 19.1213C3.44129 19.6839 4.20435 20 5 20H13C13.7956 20 14.5587 19.6839 15.1213 19.1213C15.6839 18.5587 16 17.7956 16 17V6H17C17.2652 6 17.5196 5.89464 17.7071 5.70711C17.8946 5.51957 18 5.26522 18 5C18 4.73478 17.8946 4.48043 17.7071 4.29289C17.5196 4.10536 17.2652 4 17 4ZM7 3C7 2.73478 7.10536 2.48043 7.29289 2.29289C7.48043 2.10536 7.73478 2 8 2H10C10.2652 2 10.5196 2.10536 10.7071 2.29289C10.8946 2.48043 11 2.73478 11 3V4H7V3ZM14 17C14 17.2652 13.8946 17.5196 13.7071 17.7071C13.5196 17.8946 13.2652 18 13 18H5C4.73478 18 4.48043 17.8946 4.29289 17.7071C4.10536 17.5196 4 17.2652 4 17V6H14V17ZM11 16C11.2652 16 11.5196 15.8946 11.7071 15.7071C11.8946 15.5196 12 15.2652 12 15V9C12 8.73478 11.8946 8.48043 11.7071 8.29289C11.5196 8.10536 11.2652 8 11 8C10.7348 8 10.4804 8.10536 10.2929 8.29289C10.1054 8.48043 10 8.73478 10 9V15C10 15.2652 10.1054 15.5196 10.2929 15.7071C10.4804 15.8946 10.7348 16 11 16Z"
                    fill="currentColor"
                />
            </svg>
            <span slot="text">{DELETE_SELECTED}</span>
        </ButtonWithIcon>
    </div>

    <div class="text">
        <p>
            {YOU_HAVE}
            {items_quantity}
            {ITEMS_SELECTED}
        </p>
    </div>
</div>

<style>
    .items_header {
        font-family: Poppins, sans-serif;
        display: flex;
        justify-content: start;
        gap: 1.375rem;
        padding-bottom: 0.875rem;
        border-bottom: 4px solid var(--light-violet);
    }

    .text {
        display: flex;
        align-items: end;
    }

    svg {
        color: var(--logo-color);
    }

    p {
        font-size: 1.125rem;
        font-weight: bold;
        color: var(--logo-background);
    }
</style>
