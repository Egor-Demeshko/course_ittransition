<script>
    import { fly } from "svelte/transition";
    let sunActive = false;
    let locked = false;

    function freezedToogle() {
        if (locked) return;
        locked = true;
        setTimeout(() => {
            locked = false;
        }, 400);
        sunActive = !sunActive;
        document.documentElement.setAttribute(
            "class",
            sunActive ? "theme-dark" : ""
        );
    }
</script>

<div
    class="toggler {sunActive ? 'sunActive' : 'moonActive'}"
    on:click={freezedToogle}
>
    <div class="background"></div>
    {#if sunActive}
        <div class="sun" in:fly={{ y: 50, delay: 400 }} out:fly={{ y: 50 }}>
            <svg
                viewBox="0 0 18 18"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                    d="M3.16669 9.00002C3.16669 8.77901 3.07889 8.56704 2.92261 8.41076C2.76633 8.25448 2.55437 8.16669 2.33335 8.16669H1.50002C1.27901 8.16669 1.06704 8.25448 0.910765 8.41076C0.754484 8.56704 0.666687 8.77901 0.666687 9.00002C0.666687 9.22103 0.754484 9.433 0.910765 9.58928C1.06704 9.74556 1.27901 9.83335 1.50002 9.83335H2.33335C2.55437 9.83335 2.76633 9.74556 2.92261 9.58928C3.07889 9.433 3.16669 9.22103 3.16669 9.00002ZM3.70002 13.1667L3.10835 13.7584C2.95314 13.9145 2.86603 14.1257 2.86603 14.3459C2.86603 14.566 2.95314 14.7772 3.10835 14.9334C3.26449 15.0886 3.4757 15.1757 3.69585 15.1757C3.91601 15.1757 4.12722 15.0886 4.28335 14.9334L4.87502 14.3417C5.01154 14.1823 5.08288 13.9772 5.07478 13.7675C5.06668 13.5577 4.97974 13.3588 4.83132 13.2104C4.68291 13.062 4.48396 12.975 4.27423 12.9669C4.0645 12.9588 3.85944 13.0302 3.70002 13.1667ZM9.00002 3.16669C9.22103 3.16669 9.433 3.07889 9.58928 2.92261C9.74556 2.76633 9.83335 2.55437 9.83335 2.33335V1.50002C9.83335 1.27901 9.74556 1.06704 9.58928 0.910765C9.433 0.754484 9.22103 0.666687 9.00002 0.666687C8.77901 0.666687 8.56705 0.754484 8.41077 0.910765C8.25448 1.06704 8.16669 1.27901 8.16669 1.50002V2.33335C8.16669 2.55437 8.25448 2.76633 8.41077 2.92261C8.56705 3.07889 8.77901 3.16669 9.00002 3.16669ZM13.7167 5.11669C13.9353 5.11577 14.1448 5.02897 14.3 4.87502L14.8917 4.28335C14.9789 4.20865 15.0498 4.11672 15.0998 4.01333C15.1498 3.90994 15.1779 3.79733 15.1824 3.68256C15.1868 3.5678 15.1674 3.45336 15.1256 3.34642C15.0837 3.23948 15.0201 3.14236 14.9389 3.06115C14.8577 2.97993 14.7606 2.91638 14.6536 2.87449C14.5467 2.83259 14.4322 2.81326 14.3175 2.81769C14.2027 2.82212 14.0901 2.85023 13.9867 2.90025C13.8833 2.95027 13.7914 3.02112 13.7167 3.10835L13.1667 3.70002C13.0115 3.85616 12.9244 4.06737 12.9244 4.28752C12.9244 4.50767 13.0115 4.71889 13.1667 4.87502C13.3136 5.02116 13.5097 5.10731 13.7167 5.11669ZM3.71669 4.87502C3.8719 5.02897 4.0814 5.11577 4.30002 5.11669C4.40969 5.11732 4.51841 5.0963 4.61994 5.05483C4.72147 5.01336 4.81382 4.95225 4.89169 4.87502C5.0469 4.71889 5.13401 4.50767 5.13401 4.28752C5.13401 4.06737 5.0469 3.85616 4.89169 3.70002L4.30002 3.10835C4.22287 3.03011 4.13106 2.96782 4.02984 2.92506C3.92862 2.88229 3.81996 2.85988 3.71008 2.85911C3.6002 2.85834 3.49124 2.87921 3.38942 2.92055C3.28761 2.96188 3.19493 3.02287 3.11669 3.10002C3.03844 3.17717 2.97616 3.26898 2.93339 3.3702C2.89063 3.47142 2.86822 3.58008 2.86744 3.68996C2.86588 3.91188 2.95254 4.12533 3.10835 4.28335L3.71669 4.87502ZM16.5 8.16669H15.6667C15.4457 8.16669 15.2337 8.25448 15.0774 8.41076C14.9212 8.56704 14.8334 8.77901 14.8334 9.00002C14.8334 9.22103 14.9212 9.433 15.0774 9.58928C15.2337 9.74556 15.4457 9.83335 15.6667 9.83335H16.5C16.721 9.83335 16.933 9.74556 17.0893 9.58928C17.2456 9.433 17.3334 9.22103 17.3334 9.00002C17.3334 8.77901 17.2456 8.56704 17.0893 8.41076C16.933 8.25448 16.721 8.16669 16.5 8.16669ZM14.3 13.1667C14.1417 13.0786 13.959 13.0446 13.7796 13.0696C13.6002 13.0947 13.4338 13.1776 13.3057 13.3057C13.1776 13.4338 13.0947 13.6001 13.0696 13.7796C13.0446 13.959 13.0786 14.1417 13.1667 14.3L13.7584 14.8917C13.9145 15.0469 14.1257 15.134 14.3459 15.134C14.566 15.134 14.7772 15.0469 14.9334 14.8917C15.0886 14.7356 15.1757 14.5243 15.1757 14.3042C15.1757 14.084 15.0886 13.8728 14.9334 13.7167L14.3 13.1667ZM9.00002 4.41669C8.09352 4.41669 7.20738 4.68549 6.45366 5.18912C5.69993 5.69274 5.11247 6.40856 4.76557 7.24605C4.41867 8.08355 4.32791 9.0051 4.50475 9.89418C4.6816 10.7833 5.11812 11.5999 5.75911 12.2409C6.4001 12.8819 7.21678 13.3184 8.10586 13.4953C8.99494 13.6721 9.91649 13.5814 10.754 13.2345C11.5915 12.8876 12.3073 12.3001 12.8109 11.5464C13.3145 10.7927 13.5834 9.90652 13.5834 9.00002C13.5812 7.78512 13.0976 6.62061 12.2385 5.76155C11.3794 4.90248 10.2149 4.41889 9.00002 4.41669ZM9.00002 11.9167C8.42316 11.9167 7.85925 11.7456 7.37961 11.4251C6.89996 11.1047 6.52613 10.6491 6.30537 10.1162C6.08462 9.58323 6.02686 8.99678 6.1394 8.43101C6.25194 7.86523 6.52972 7.34553 6.93763 6.93763C7.34553 6.52972 7.86523 6.25194 8.43101 6.1394C8.99678 6.02686 9.58323 6.08462 10.1162 6.30537C10.6491 6.52613 11.1047 6.89996 11.4251 7.37961C11.7456 7.85925 11.9167 8.42316 11.9167 9.00002C11.9167 9.77357 11.6094 10.5154 11.0624 11.0624C10.5154 11.6094 9.77357 11.9167 9.00002 11.9167ZM9.00002 14.8334C8.77901 14.8334 8.56705 14.9212 8.41077 15.0774C8.25448 15.2337 8.16669 15.4457 8.16669 15.6667V16.5C8.16669 16.721 8.25448 16.933 8.41077 17.0893C8.56705 17.2456 8.77901 17.3334 9.00002 17.3334C9.22103 17.3334 9.433 17.2456 9.58928 17.0893C9.74556 16.933 9.83335 16.721 9.83335 16.5V15.6667C9.83335 15.4457 9.74556 15.2337 9.58928 15.0774C9.433 14.9212 9.22103 14.8334 9.00002 14.8334Z"
                    fill="currentColor"
                />
            </svg>
        </div>
    {:else}
        <div class="moon" in:fly={{ y: 50, delay: 400 }} out:fly={{ y: 50 }}>
            <svg
                viewBox="0 0 17 17"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
            >
                <path
                    d="M16.1588 9.10119C16.0401 9.00305 15.8962 8.94022 15.7435 8.91986C15.5908 8.8995 15.4354 8.92243 15.2951 8.98603C14.4253 9.38407 13.4796 9.58893 12.523 9.58652C10.7535 9.58438 9.05663 8.88275 7.80232 7.63461C6.54802 6.38647 5.83804 4.69305 5.82718 2.92358C5.83093 2.36902 5.89996 1.81683 6.03283 1.27841C6.06103 1.1349 6.05045 0.98647 6.00219 0.848408C5.95394 0.710346 5.86974 0.587646 5.75828 0.49295C5.64683 0.398254 5.51214 0.334986 5.3681 0.309664C5.22405 0.284343 5.07586 0.297883 4.93879 0.34889C3.64925 0.928737 2.52826 1.82688 1.68116 2.95894C0.834048 4.091 0.288619 5.41982 0.0961091 6.82057C-0.096401 8.22131 0.0703264 9.64801 0.580629 10.9666C1.09093 12.2852 1.92806 13.4525 3.01337 14.3587C4.09867 15.265 5.39654 15.8804 6.78504 16.1473C8.17354 16.4142 9.60709 16.3237 10.951 15.8844C12.295 15.4451 13.5052 14.6714 14.4679 13.6359C15.4307 12.6004 16.1145 11.3372 16.455 9.96491C16.4965 9.80779 16.4905 9.64191 16.4378 9.48819C16.3851 9.33448 16.288 9.19981 16.1588 9.10119ZM8.34429 14.6043C6.9638 14.5945 5.62006 14.1583 4.49706 13.3554C3.37406 12.5524 2.5267 11.422 2.071 10.1188C1.6153 8.81568 1.57354 7.40353 1.95144 6.07573C2.32934 4.74793 3.10842 3.56939 4.18201 2.70148V2.92358C4.18419 5.13509 5.06367 7.25539 6.62744 8.81916C8.19122 10.3829 10.3115 11.2624 12.523 11.2646C13.1037 11.2667 13.6829 11.206 14.2505 11.0836C13.6828 12.1575 12.8327 13.0561 11.7919 13.6823C10.751 14.3085 9.55899 14.6387 8.34429 14.6372V14.6043Z"
                    fill="currentColor"
                />
            </svg>
        </div>
    {/if}
</div>

<style>
    .toggler {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        cursor: pointer;
        color: var(--white);
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px;
        overflow: hidden;
        transition: background 0.8s ease;
    }

    .background {
        width: 100px;
        height: 60px;
        position: absolute;
        top: 0;
        left: 0;
        transition: transform 0.8s ease;
        transform: translate(0, 0);
        z-index: -1;
    }

    .moon {
        color: var(--light-grey);
    }

    .background {
        background: radial-gradient(
            100% 100% at 0% 40%,
            rgb(240, 216, 1) 0%,
            rgb(219, 121, 0) 49%,
            #748c97 52%,
            var(--dark-violet) 100%
        );
    }

    .sunActive .background {
        transform: translate(0, 0);
    }

    .moonActive .background {
        transform: translate(-52%, 0);
    }

    .toggler.sunActive {
        box-shadow: 0 0 14px 0px orange;
    }

    .toggler.moonActive {
        box-shadow: 0 0 14px 0px var(--violet);
    }
</style>
